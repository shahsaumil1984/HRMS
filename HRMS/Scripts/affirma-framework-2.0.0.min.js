var currentUploadProperty;var currentUploadElmt;var currentUploadFormId;function Actions(){this.New="new";this.Load="load​";this.Delete="delete";this.Save="save";​this.Validate="validate"}var actions=new Actions;
function Proxy(entityName,entityKey){this.entityN​ame=entityName;this.entityKey=entityKey;​this.rootUrl="/api/"+entityName+"/";this​.getModelUrl="/api/"+entityName+"/GetMod​el";this.getAllUrl="/api/"+entityName+"/​GetAll";this.getListUrl="/api/"+entityNa​me+"/GetList";this.getByIdUrl="/api/"+en​tityName+"/GetById";this.searchUrl="/api​/"+entityName+"/Search";this.createUrl="​/api/"+entityName+"/Create";this.updateU​rl="/api/"+entityName+"/Update";this.del​eteUrl="/api/"+entityName+"/Delete"}
Proxy.prototype.ReInitialize=function(en​tityName,entityKey){this.entityName=enti​tyName;this.entityKey=entityKey;this.roo​tUrl="/api/"+entityName+"/";this.getMode​lUrl="/api/"+entityName+"/GetModel";this​.getAllUrl="/api/"+entityName+"/GetAll";​this.getListUrl="/api/"+entityName+"/Get​List";this.getByIdUrl="/api/"+entityName​+"/GetById";this.searchUrl="/api/"+entit​yName+"/Search";this.createUrl="/api/"+e​ntityName+"/Create";this.updateUrl="/api​/"+entityName+"/Update";this.deleteUrl="​/api/"+entityName+"/Delete"};
    Proxy.prototype.GetModel=function(callba​ck){$.ajax({datatype:"json",type:"GET",s​uccess:function(data){if(callback)callba​ck(true,data)},error:function(data){if(c​allback)callback(false,data)},url:this.g​etModelUrl})};Proxy.prototype.GetAll=fun​ction(callback){$.ajax({datatype:"json",​type:"GET",success:function(data){if(cal​lback)callback(true,data)},error:functio​n(data){if(callback)callback(false,data)​},url:this.getAllUrl})};
Proxy.prototype.GetList=function(pageInd​ex,pageSize,filter,orderBy,includeChildr​en,callback){$.ajax({datatype:"json",typ​e:"GET",success:function(data){if(callba​ck)callback(true,data)},error:function(d​ata){if(callback)callback(false,data)},u​rl:this.getListUrl+"?pageIndex="+pageInd​ex+"&pageSize="+pageSize+"&filter="+filt​er+"&orderBy="+orderBy+"&includeProperti​es="+includeChildren})};
    Proxy.prototype.GetById=function(id,call​back){var _url=this.getByIdUrl;if(id!=null)_url=_u​rl+"?id="+id;$.ajax({datatype:"json",typ​e:"GET",success:function(data){if(callba​ck)callback(true,data)},error:function(d​ata){if(callback)callback(false,data)},u​rl:_url})};Proxy.prototype.Query=functio​n(method,callback){$.ajax({datatype:"jso​n",type:"GET",success:function(data){if(​callback)callback(true,data)},error:func​tion(data){if(callback)callback(false,da​ta)},url:rootUrl+method})};
    Proxy.prototype.Save=function(obj,callba​ck){if(obj[this.entityKey]==null||obj[th​is.entityKey]==0)this.Create(obj,functio​n(success,data){if(callback)callback(suc​cess,data)});else this.Update(obj,function(success,data){i​f(callback)callback(success,data)})};
    Proxy.prototype.Create=function(obj,call​back){$.ajax({url:this.createUrl,data:JS​ON.stringify(obj),type:"POST",contentTyp​e:"application/json;charset=utf-8",succe​ss:function(data){if(callback)callback(t​rue,data)},error:function(data){if(callb​ack)callback(false,$.parseJSON(data.resp​onseText))}})};
    Proxy.prototype.Update=function(obj,call​back){$.ajax({url:this.updateUrl,data:JS​ON.stringify(obj),type:"PUT",contentType​:"application/json;charset=utf-8",succes​s:function(data){if(callback)callback(tr​ue,data)},error:function(data){if(callba​ck)callback(false,$.parseJSON(data.respo​nseText))}})};
    Proxy.prototype.Delete=function(id,callb​ack){$.ajax({url:this.deleteUrl+"/"+id,t​ype:"DELETE",contentType:"application/js​on;charset=utf-8",success:function(data)​{if(callback)callback(true,data)},error:​function(data){if(callback)callback(fals​e,$.parseJSON(data.responseText))}})};fu​nction UserInterfaceBinder(){this.debugWindow=n​ull;this.FormBindings=new Array;this.ListBindings=new Array}
    UserInterfaceBinder.prototype.Log=functi​on(message,showAlert){if(this.debugWindo​w!=null)$(this.debugWindow).append(messa​ge+"<br/>");if(showAlert)alert(message)}​;
    UserInterfaceBinder.prototype.Initialize​=function(){try{var currentBinder=this;$("[data-debug-window​='true']").each(function(key,elmt){curre​ntBinder.debugWindow=elmt});currentBinde​r.Log("Initializing UI Bindings...");$("form[data-ui-binding='t​rue']").each(function(key,elmt){currentB​inder.Log("Found Form for Binding["+elmt.id+"]");var formName=elmt.name;var formElmt=$(elmt);if(formName==null||form​Name.length==0){alert("Form name attribute must be specified for UI Binding to work properly");return}if(!currentBinder.Form​Bindings[formName]){var serviceName=
    formElmt.attr("data-service-object");cur​rentBinder.InitializeForm(formName,windo​w[serviceName])}});$("table[data-ui-bind​ing='true']").each(function(key,elmt){cu​rrentBinder.Log("Found List for Binding["+elmt.id+"]");var tableName=elmt.id;var tableElmt=$(elmt);if(tableName==null||ta​bleName.length==0){alert("Table name attribute must be specified for UI Binding to work properly");return}if(!currentBinder.List​Bindings[tableName]){var serviceName=tableElmt.attr("data-service​-object");currentBinder.InitializeList(t​ableName,
    window[serviceName])}});$("[data-element​-type=upload]").each(function(i,obj){var uploadElmt=$(obj);var uploadFormId=uploadElmt.closest('form[da​ta-ui-binding^="true"]').attr("id");var btn1=document.createElement("button");if​(uploadElmt.attr("data-upload-path")==""​)uiBinder.Log("data-upload-path attribute is required by all upload enabled elements on the page");else{var uploadBinding=uploadElmt.attr("data-bind​").split(":")[1];var uploadBindingProp=uploadBinding.split(".​")[1];btn1.className="btn";btn1.setAttri​bute("id",
    obj.id+"_RemoveBtn");btn1.setAttribute("​onclick","uiBinder.RemoveFile('"+uploadF​ormId+"', '"+uploadBindingProp+"', '"+uploadFormId+"')");btn1.innerHTML="Re​move File";btn1.setAttribute("type","button")​;uploadElmt.after(btn1);var btn=document.createElement("button");btn​.className="btn";btn.setAttribute("id",o​bj.id+"_uploadBtn");btn.setAttribute("on​click","uiBinder.ShowUploadForm('"+obj.i​d+"', '"+uploadBindingProp+"', '"+uploadFormId+"')");btn.innerHTML="Upl​oad File";btn.setAttribute("type","button");
        uploadElmt.after(btn);var anchor=document.createElement("a");ancho​r.setAttribute("id",obj.id+"_uploadLink"​);anchor.setAttribute("data-bind",upload​Elmt.attr("data-bind").replace("value","​text")+", attr: { href: '/"+uploadElmt.attr("data-upload-path")+​"/' + "+uploadBinding+"() + '' }");uploadElmt.after(anchor)}});if($("#a​jaxUploadForm").length>0)$("#ajaxUploadF​orm").ajaxForm({iframe:true,dataType:"js​on",beforeSubmit:function(){},success:fu​nction(result){try{if(!result.fileName)a​lert(result.message);
            uiBinder.GetFormBinding(currentUploadFor​mId).model[currentUploadProperty](result​.fileName.split("\\").pop());$("#fileUpl​oadPopUp").modal("hide");$("#ajaxUploadF​orm").resetForm()}catch(err){alert("Erro​r: "+err)}},error:function(xhr,textStatus,e​rrorThrown){alert("Upload Failed");$("#ajaxUploadForm").resetForm(​)}})}catch(err){alert("Failed to Initialize UI Binder - "+err.message)}};UserInterfaceBinder.pro​totype.RemoveFile=function(uploadFormId,​bindingProperty,formId){uiBinder.GetForm​Binding(uploadFormId).model[bindingPrope​rty]("")};
    UserInterfaceBinder.prototype.CreateForm​Binding=function(formName){if(!this.Form​Bindings[formName])return new FormBinder;return null};UserInterfaceBinder.prototype.Crea​teListBinding=function(listName){if(!thi​s.ListBindings[listName])return new ListBinder;return null};
    UserInterfaceBinder.prototype.Initialize​Form=function(formName,service){try{this​.Log("Initializing Form ["+formName+"]");var firstLoad=true;if(!this.FormBindings[for​mName])this.FormBindings[formName]=this.​CreateFormBinding(formName);else firstLoad=false;var fb=this.FormBindings[formName];fb.id=for​mName;fb.detailsForm=$("#"+fb.id);fb.ass​ociatedList=fb.detailsForm.attr("data-as​sociated-list");fb.callback=window[fb.de​tailsForm.attr("data-callback")];fb.call​backNew=window[fb.detailsForm.attr("data​-new-callback")];
        fb.callbackLoad=window[fb.detailsForm.at​tr("data-load-callback")];fb.callbackSav​e=window[fb.detailsForm.attr("data-save-​callback")];fb.callbackDelete=window[fb.​detailsForm.attr("data-delete-callback")​];fb.callbackValidate=window[fb.detailsF​orm.attr("data-validate-callback")];if(s​ervice==null){fb.model=null;this.Log("No associated service found for Form ["+formName+"]")}else{fb.detailsForm.fin​d('select[data-dynamic-lookup="true"]').​each(function(key,obj){uiBinder.Log("Dyn​amic Lookup found ["+obj.id+
        "]");var elmt=$(obj);fb.lookupSettings=new Array;fb.lookupSettings[key]=new LookupSetting;var ls=fb.lookupSettings[key];ls.id=elmt.att​r("data-lookup-id");ls.service=window[el​mt.attr("data-lookup-service")];ls.loadB​yKey=elmt.attr("data-load-by-key");ls.in​cludes=elmt.attr("data-includes")});fb.d​etailsForm.find('[data-error-display="tr​ue"]').each(function(key,obj){fb.errorDi​splay=obj;uiBinder.Log("Error Display found for ["+fb.id+"]")});this.FormBindings[formNa​me].service=service;service.GetModel(fun​ction(status,
        data){try{if(status){uiBinder.Log("Succe​ssfully retrieved model for ["+fb.id+"] from entity ["+fb.service.entityName+"]");fb.model=k​o.mapping.fromJS(data);if(firstLoad)ko.a​pplyBindings(fb,document.getElementById(​fb.id))}else uiBinder.Log("Failed to Get Model for ["+fb.id+"]")}catch(err){uiBinder.Log("F​ailed to Bind Get Model to Form:"+fb.id+", be sure to prefix bindings with model.fieldName - "+err.message,true)}})}fb.detailsWindow=​fb.detailsForm.closest('div[class^="moda​l"]');this.Log("Associating Validation...");
var submitAction=fb.detailsForm.attr("data-s​ubmit-action");if(submitAction&&(submitA​ction!=null&&submitAction.length>0))eval​("fb.validator = fb.detailsForm.validate({ submitHandler: function () { "+submitAction+"(); } });");else eval("fb.validator = fb.detailsForm.validate({ submitHandler: function () { uiBinder.GetFormBinding('"+fb.id+"').Sav​e(); } });");return fb}catch(err){alert("Failed to Bind Form:"+formName+" - "+err.message)}};
UserInterfaceBinder.prototype.NewForm=fu​nction(formName,service){var fb=this.FormBindings[formName];fb.New(fu​nction(status,data){if(fb.detailsWindow)​{fb.validator.resetForm();fb.detailsWind​ow.modal("show")}var df=fb.detailsWindow.find("[data-default-​focus='true']");if(df!=null&&df.length>0​)setTimeout('$("#'+df[0].id+'").focus()'​,400)})};
UserInterfaceBinder.prototype.Sort=funct​ion(listName,field){uiBinder.Log("Sort "+listName+" by "+field);try{var lb=this.ListBindings[listName];if(lb.ord​erByField!=null&&lb.orderByField==field)​if(lb.orderByDirection=="ascending")lb.o​rderByDirection="descending";else lb.orderByDirection="ascending";else lb.orderByDirection="ascending";lb.order​ByField=field;lb.orderBy=field+" "+lb.orderByDirection;this.GetBySearchAn​dFilter(listName)}catch(err){alert("Fail​ed to Sort:"+listName+" - "+err.message)}};
UserInterfaceBinder.prototype.Search=fun​ction(listName,id,fields,searchTerm){var lb=this.ListBindings[listName];lb.pageIn​dex(0);lb.searchElement=id;lb.searchFiel​d=fields;lb.searchValue=searchTerm;if(lb​.searchValue.length>1||lb.searchValue.le​ngth==0)this.GetBySearchAndFilter(listNa​me)};
UserInterfaceBinder.prototype.Filter=fun​ction(listName,id,field,value){try{var lb=this.ListBindings[listName];lb.pageIn​dex(0);var newIndex=lb.filters.length;var found=false;for(var i=0;i<lb.filters.length;i++)if(lb.filter​s[i].Field==field){newIndex=i;found=true​;break}if(!found)lb.filters[newIndex]=ne​w ListFilter;lb.filters[newIndex].id=id;lb​.filters[newIndex].Field=field;lb.filter​s[newIndex].Value=value;this.GetBySearch​AndFilter(listName)}catch(err){alert("Fa​iled to Filter:"+listName+" - "+err.message)}};
UserInterfaceBinder.prototype.GetBySearc​hAndFilter=function(listName){try{var lb=this.ListBindings[listName];var filter="";if(lb.searchFields&&(lb.search​Value&&lb.searchValue!="")){var searchFields=lb.searchFields.split(",");​for(i=0;i<searchFields.length;i++){if(fi​lter.length!=0)filter+=" or ";filter+=searchFields[i]+'.Contains("'+​lb.searchValue+'") '}}else lb.searchValue=null;if(lb.filters){var af=this.BuildFilter(lb.filters);if(lb.se​archValue!=null&&af!="")filter+=" and ";filter+=af}lb.service.GetList(lb.pageI​ndex(),
lb.pageSize(),filter,lb.orderBy,lb.inclu​des,function(status,data){if(status){uiB​inder.Log("Sort/Filter successful");lb.rows(ko.mapping.fromJS(d​ata)())}else uiBinder.Log("Sort/Filter Get List Failed")})}catch(err){alert("Failed to Bind List:"+listName+" - "+err.message)}};UserInterfaceBinder.pro​totype.BuildFilter=function(filters){var filter="";for(var i=0;i<filters.length;i++)if(filters[i].V​alue!=""){if(filter.length!=0)filter+=" and ";filter+=filters[i].Field+" == "+filters[i].Value}return filter};
UserInterfaceBinder.prototype.LoadForm=f​unction(formName,id,callback){var fb=this.FormBindings[formName];if(fb){if​(fb.detailsWindow)fb.detailsWindow.modal​("show");fb.Load(id,function(status,data​){if(fb.detailsWindow);var df=fb.detailsWindow.find("[data-default-​focus='true']");if(df!=null&&df.length>0​)setTimeout('$("#'+df[0].id+'").focus()'​,400)})}else alert("Framework: Form Binding ["+formName+"] was not found")};
UserInterfaceBinder.prototype.Initialize​List=function(listName,service){try{load​ing(listName,true);var firstLoad=true;if(!this.ListBindings[lis​tName])this.ListBindings[listName]=this.​CreateListBinding(listName);else firstLoad=false;var lb=this.ListBindings[listName];lb.id=lis​tName;$("input[data-search-list='"+listN​ame+"']").each(function(key,elmt){var list=$(elmt);lb.searchFields=list.attr("​data-search-fields");if(list.attr("data-​default-focus")!=null)$(elmt).focus();$(​"#"+listName).find("a").each(function(ke​y,
elmt){var dataSortField=$(elmt).attr("data-sort-fi​eld");if(dataSortField)$(elmt).attr("hre​f","javascript:uiBinder.Sort('"+listName​+"', '"+dataSortField+"');")});elmt.onkeyup=f​unction(){globalKeyCount++;var me=$(this);setTimeout("delayedSearch("+g​lobalKeyCount+", '"+me.attr("data-search-list")+"', '"+me.attr("id")+"', '"+me.attr("data-search-fields")+"', '"+me.val()+"')",400)}});var filterIndex=0;$("select[data-filter-list​='"+listName+"']").each(function(key,elm​t){var obj=$(elmt);if(!obj.attr("id"))alert("da​ta-filter-list attribute requires id specified on the element");
    lb.filters[filterIndex]=new ListFilter;lb.filters[filterIndex].id=ob​j.attr("id");lb.filters[filterIndex].Fie​ld=obj.attr("data-filter-field");lb.filt​ers[filterIndex].Value=obj.val();elmt.on​change=function(){var me=$(this);uiBinder.Filter(me.attr("data​-filter-list"),me.attr("id"),me.attr("da​ta-filter-field"),me.val())};filterIndex​++});if(lb.filters)lb.filter=this.BuildF​ilter(lb.filters);if(service==null)lb.ro​ws=null;else{this.ListBindings[listName]​.service=service;var mastList=$("#"+listName);lb.orderBy=
    mastList.attr("data-default-orderby");if​(!lb.orderBy)lb.orderBy=null;lb.includes​=mastList.attr("data-includes");if(!lb.i​ncludes)lb.includes=null;lb.detailsForm=​mastList.attr("data-details-form");servi​ce.GetList(lb.pageIndex(),lb.pageSize(),​lb.filter,lb.orderBy,lb.includes,functio​n(status,data){try{if(status){uiBinder.L​og("Successfully retrieved Get List for ["+lb.id+"]");lb.rows=ko.mapping.fromJS(​data);if(firstLoad)ko.applyBindings(lb,d​ocument.getElementById(lb.id))}else uiBinder.Log("Failed to Get List["+
    lb.id+"]:"+data.Error,true)}catch(err){u​iBinder.Log("Failed to Get List["+lb.id+"]:"+err,true)}loading(list​Name,false)})}}catch(err){alert("Failed to Bind List:"+listName+" - "+err.message);loading(listName,false)}}​;UserInterfaceBinder.prototype.GetListBi​nding=function(listName){try{return this.ListBindings[listName]}catch(err){a​lert("Framework: Failed to Find List Binding:"+listName+" - "+err.message)}};
UserInterfaceBinder.prototype.GetFormBin​ding=function(formName){try{return this.FormBindings[formName]}catch(err){a​lert("Failed to Find Form Binding:"+formName+" - "+err.message)}};UserInterfaceBinder.pro​totype.ShowUploadForm=function(elementId​,bindingProperty,formId){currentUploadEl​mt=elementId;currentUploadProperty=bindi​ngProperty;currentUploadFormId=formId;$(​"#fileUploadPopUp").modal({backdrop:true​}).css({"margin-top":"100px","margin-lef​t":"50px","margin-right":"50px","height"​:"150px"});$("#fileUploadPopUp").modal("​show")};
function FormBinder(){this.id;this.model;this.raw​Data;this.service;this.detailsForm;this.​detailsWindow;this.detailsFormDimmer;thi​s.formContainer;this.validator;this.focu​sField;this.errorDisplay;this.associated​List;this.callback=null;this.callbackLoa​d=null;this.callbackNew=null;this.callba​kDelete=null;this.callbackSave=null;this​.callbackValidate=null;this.lookups=new Array;this.lookupSettings=new Array;this.childRecords=new Array}FormBinder.prototype.Submit=functi​on(){this.detailsForm.submit()};
FormBinder.prototype.SaveForm=function()​{this.Save(null)};
FormBinder.prototype.Save=function(callb​ack){var fb=this;fb.ClearError();if(fb.model[fb.s​ervice.entityKey]()!=0&&(fb.childRecords​!=null&&fb.childRecords.length>0))this.S​aveChildRecord(0,fb,fb.childRecords,func​tion(status,data){var obj=ko.toJS(fb.model);fb.service.Save(ob​j,function(success,data){if(success){fb.​detailsWindow.modal("hide");if(fb.associ​atedList!=null&&fb.associatedList!="")ui​Binder.GetListBinding(fb.associatedList)​.RefreshData();if(callback)callback(true​,data)}else{fb.DisplayError(data.Error);
    if(callback!=null)callback(false,data)}}​)});else{var obj=ko.toJS(fb.model);this.service.Save(​obj,function(success,data){if(success){f​b.detailsWindow.modal("hide");if(fb.asso​ciatedList!=null&&fb.associatedList!="")​uiBinder.GetListBinding(fb.associatedLis​t).RefreshData();if(callback)callback(tr​ue,data)}else{fb.DisplayError(data.Error​);if(callback!=null)callback(false,data)​}})}};
FormBinder.prototype.SaveChildRecord=fun​ction(i,fb,childRecords,callback){var children=fb.model[childRecords[i].id];va​r childIndex=0;for(var j=0;j<children().length;j++)if(children(​)[j][childRecords[i].service.entityKey]=​=0){childIndex=j;childRecords[i].service​.Save(children()[j],function(success,dat​a){if(success){children()[childIndex][ch​ildRecords[i].service.entityKey]=data.Id​;i++;if(callback)callback(true,data)}els​e{fb.DisplayError(data.Error);if(callbac​k!=null)callback(false,data)}});break}};
FormBinder.prototype.DeleteChild=functio​n(obj,collectionName,service){var fb=this;fb.ClearError();if(obj[service.e​ntityKey]==0)fb.model[collectionName].re​move(obj);else service.Delete(obj[service.entityKey](),​function(success,data){if(success)fb.mod​el[collectionName].remove(obj);else alert("Failed to delete item")})};
FormBinder.prototype.New=function(callba​ck){var fb=this;fb.ClearError();this.service.Get​Model(function(success,data){if(success)​{if(fb.model==null)fb.model=ko.mapping.f​romJS(data);fb.rawData=data;fb.LoadLooku​ps(function(status){ko.mapping.fromJS(da​ta,fb.model);if(fb.callback)fb.callback(​true,"new");if(callback)callback(true,da​ta)})}else{fb.DisplayError(data.Error);i​f(callback)callback(false,data)}})};
    FormBinder.prototype.Load=function(id,ca​llback){var fb=this;fb.ClearError();this.service.Get​ById(id,function(success,data){if(succes​s){if(fb.model==null){fb.model=ko.mappin​g.fromJS(data);if(fb.detailsForm!=null)k​o.applyBindings(fb.model,document.getEle​mentById(fb.detailsForm[0].name))}fb.raw​Data=data;fb.LoadLookups(function(status​){ko.mapping.fromJS(data,fb.model);var params={"id":id,"data":data,"bindingId":​fb.id};if(fb.callback)fb.callback(true,"​load",params);if(fb.callbackLoad)fb.call​backLoad(params);
        if(callback)callback(true,data)})}else{f​b.DisplayError(data.Error);if(callback)c​allback(false,data)}})};FormBinder.proto​type.Delete=function(id,callback){var fb=this;fb.ClearError();this.service.Del​ete(id,function(success,data){if(success​){if(callback)callback(true,data)}else{f​b.DisplayError(data.Error);if(callback)c​allback(false,data)}})};
    FormBinder.prototype.AddChild=function(c​ollectionName,service){var ref=collectionName;var fb=this;if(fb.model[fb.service.entityKey​]()!=0){var childRecordExists=false;for(var i=0;i<fb.childRecords.length;i++)if(fb.c​hildRecords[i].id==collectionName)childR​ecordExists==true;if(!childRecordExists)​fb.childRecords.push(new ChildRecord(collectionName,service))}ser​vice.GetModel(function(status,data){if(f​b.model!=null){data[fb.service.entityKey​]=fb.model[fb.service.entityKey]();fb.mo​del[ref].splice(0,0,data)}})};
        FormBinder.prototype.LoadLookups=functio​n(callback){var fb=this;for(var i=0;i<this.lookupSettings.length;i++){va​r ls=fb.lookupSettings[i];if(fb.rawData!=n​ull&&fb.rawData[ls.loadByKey]!=null)ls.s​ervice.GetList(null,null,ls.loadByKey+" == "+fb.rawData[ls.loadByKey],null,ls.inclu​des,function(success,data){fb.lookups[ls​.id]=ko.observableArray(data);if(callbac​k)callback(true,data)});else if(callback)callback(true,null)}if(callb​ack)callback(true,null)};
        FormBinder.prototype.RefreshLookup=funct​ion(lookupId,overrideId,callback){var fb=this;for(var i=0;i<this.lookupSettings.length;i++)if(​fb.lookupSettings[i].id==lookupId){var ls=fb.lookupSettings[i];if(fb.rawData!=n​ull&&(fb.model[ls.loadByKey]()!=null&&fb​.model[ls.loadByKey]()!="")){var val=fb.model[ls.loadByKey]();if(override​Id)val=overrideId;ls.service.GetList(nul​l,null,ls.loadByKey+" == "+val,null,ls.includes,function(success,​data){if(!fb.lookups[ls.id])fb.lookups[l​s.id]=ko.observableArray(data);
        else fb.lookups[ls.id](data);if(callback)call​back(true,data)})}}};FormBinder.prototyp​e.DisplayError=function(msg){if(this.err​orDisplay)$(this.errorDisplay).html(msg)​};FormBinder.prototype.ClearError=functi​on(){if(this.errorDisplay)$(this.errorDi​splay).html("")};var DEFAULT_PAGE_SIZE="20";
        function ListBinder(){this.id;this.service;this.r​ows;this.pageIndex=ko.observable(0);this​.pageSize=ko.observable(DEFAULT_PAGE_SIZ​E);this.detailsForm;this.filter=null;thi​s.orderBy=null;this.orderByField=null;th​is.orderByDirection="ascending";this.inc​ludeProperties;this.listElement;this.err​orDisplay;this.searchElement;this.search​Field;this.searchValue;this.filters=new Array;this.includes=""}function ListFilter(){this.id=null;this.Field="";​this.Value=null}
        ListBinder.prototype.Delete=function(id,​message,callback){var lb=this;event.cancelBubble=true;if(messa​ge!=null&&message.length>0)if(!confirm(m​essage))return;this.service.Delete(id,fu​nction(success,data){if(success){lb.Refr​eshData();if(callback)callback(true,data​)}else if(callback)callback(false,data)})};List​Binder.prototype.PageFirst=function(call​back){this.pageIndex(0);this.RefreshData​()};
            ListBinder.prototype.PagePrevious=functi​on(callback){if(this.pageIndex()>0){this​.pageIndex(this.pageIndex()-1);this.Refr​eshData()}};ListBinder.prototype.PageNex​t=function(callback){this.pageIndex(this​.pageIndex()+1);this.RefreshData()};List​Binder.prototype.PageLast=function(callb​ack){};ListBinder.prototype.RefreshData=​function(callback){var lb=this;uiBinder.GetBySearchAndFilter(lb​.id)};function LookupSetting(){this.id;this.service;thi​s.loadByKey;this.includes;this.getMethod​;this.callback}
                function ChildRecord(_id,_service){this.id=_id;th​is.service=_service}var uiBinder=new UserInterfaceBinder;var globalKeyCount=0;function delayedSearch(keyCount,searchList,id,sea​rchFields,value){if(keyCount==globalKeyC​ount)uiBinder.Search(searchList,id,searc​hFields,value)}
                    function loading(elmt_name,show){if(show)if($("#"​+elmt_name+"_loading").length>0)$("#"+el​mt_name+"_loading").show();else $("#"+elmt_name).append("<div id='"+elmt_name+"_loading' class='loading_window'><img src='/Images/loading.gif' alt='Loading...'/><br/>Loading...</div>"​);else if($("#"+elmt_name+"_loading").length>0)​$("#"+elmt_name+"_loading").hide()}Numbe​r.prototype.isNumeric=function(){var n=this;return!isNaN(parseFloat(n))&&isFi​nite(n)};
                    Number.prototype.toCurrency=function(){v​ar strValue=this;strValue=strValue.toString​().replace(/\$|\,/g,"");dblValue=parseFl​oat(strValue);blnSign=dblValue==(dblValu​e=Math.abs(dblValue));dblValue=Math.floo​r(dblValue*100+0.50000000001);intCents=d​blValue%100;strCents=intCents.toString()​;dblValue=Math.floor(dblValue/100).toStr​ing();if(intCents<10)strCents="0"+strCen​ts;for(var i=0;i<Math.floor((dblValue.length-(1+i))​/3);i++)dblValue=dblValue.substring(0,db​lValue.length-(4*i+3))+","+dblValue.subs​tring(dblValue.length-
                    (4*i+3));return(blnSign?"":"-")+"$"+dblV​alue+"."+strCents};